<ng-template #headerTemplate>
    <div class="table-thead tableHeader">
        <div class="fLeft">
            <!-- 图表切换按钮 -->
            <button nz-button [class.btnActive]="!isShowTable" [nzSize]="'small'" nzType="default" (click)="chartBtnClick()" nz-tooltip nzTitle="{{'view.s_view' | translate}}">
                <i class="anticon anticon-area-chart"></i>
            </button>
            <button *ngIf="!isOnlyChart" nz-button [class.btnActive]="isShowTable" [nzSize]="'small'" nzType="default" (click)="tableBtnClick()" nz-tooltip nzTitle="{{'view.t_view' | translate}}">
                <i class="anticon anticon-table"></i>
            </button>
            <!-- 选择面板 显示隐藏icon -->
            <span *ngIf="isHasSelectPanel && selectPanelList.length" style="margin-left:10px" (click)='showSelectPanel()'>
                <i class="iconfont icon-zhankai"></i>
            </span>
            <!-- 下拉框 -->
            <ng-container *ngTemplateOutlet="selectTemplate ? selectTemplate :''"></ng-container>
            <!-- 图类型下拉 -->
            <nz-select *ngIf="!isShowTable && chartTypeData && chartTypeData.length" style="width: 120px;" class="ml12" nzSize="small" [(ngModel)]="chartType" (ngModelChange)="chartTypeChange()">
                <nz-option *ngFor="let item of chartTypeData" [nzLabel]="item.value" [nzValue]="item.key"></nz-option>
            </nz-select>
            <!--左-其他模块 -->
            <ng-container *ngTemplateOutlet="(otherLeftTemplate && (!chartError || !tableError)) ? otherLeftTemplate :''"></ng-container>     
        </div>
        <div class="fRight">
            <!-- 右-其他模块 -->
            <ng-container *ngTemplateOutlet="(otherRightTemplate && (!chartError || !tableError)) ? otherRightTemplate :''"></ng-container>
            <!-- 单选、多选 -->
            <nz-switch style="vertical-align: middle;margin-top: -5px;" *ngIf="!isShowTable && isHasMultiSelect && !chartError" class="switchBtn" [(ngModel)]="isMultiSelect" (ngModelChange)="getSelectModule()" nzCheckedChildren="{{'tableButton.multiple' | translate}}" nzUnCheckedChildren="{{'tableButton.single' | translate}}"></nz-switch>
            <button *ngIf="!isShowTable && isHasMultiSelect && !chartError" class="multiConfirmBtn" nz-button nzType="primary" [nzSize]="'small'" [disabled]="!isMultiSelect" (click)="multipleConfirm()">{{'tableButton.confirm' | translate}}</button>
            <!-- 精度下拉框 -->
            <!-- <nz-select style="width: 180px;margin-right: 10px" [(ngModel)]="accuracy" [nzSize]="'small'" *ngIf="isShowTable && isShowAccuracy">
                <nz-option *ngFor="let accu of accuracyList" [nzLabel]="accu.name" [nzValue]="accu.value"></nz-option>
            </nz-select> -->
            <nz-select style="width: 180px;margin-right: 10px" [(ngModel)]="accuracy" [nzSize]="'small'" *ngIf="isShowTable && isShowAccuracy">
                <nz-option [nzLabel]="'accuracy.toFixedOne' | translate" [nzValue]="1"></nz-option>
                <nz-option [nzLabel]="'accuracy.toFixedTwo' | translate" [nzValue]="2"></nz-option>
                <nz-option [nzLabel]="'accuracy.toFixedThree' | translate" [nzValue]="3"></nz-option>
                <nz-option [nzLabel]="'accuracy.toFixedFour' | translate" [nzValue]="4"></nz-option>
                <nz-option [nzLabel]="'accuracy.toFixedFive' | translate" [nzValue]="5"></nz-option>
                <nz-option [nzLabel]="'accuracy.toFixedSix' | translate" [nzValue]="6"></nz-option>
                <nz-option [nzLabel]="'accuracy.toFixedSeven' | translate" [nzValue]="7"></nz-option>
                <nz-option [nzLabel]="'accuracy.toFixedAll' | translate" [nzValue]="-1"></nz-option>
            </nz-select>
            <!-- 设置 -->
            <ng-container *ngTemplateOutlet="(setTemplate && (!chartError || !tableError)) ? setTemplate :''"></ng-container>
            <!-- 刷新-->
            <!-- getTableData getTableData getChartData -->
            <i *ngIf="!chartUrl" class="iconfont icon-shuaxin" (click)="handlerRefresh()" nz-tooltip [nzTitle]="'tableButton.refresh' | translate"></i>
            <i *ngIf="chartUrl && isShowTable" class="iconfont icon-shuaxin" (click)="handlerRefresh()" nz-tooltip [nzTitle]="'tableButton.refresh' | translate"></i>
            <i *ngIf="chartUrl && !isShowTable" class="iconfont icon-shuaxin" (click)="handlerRefresh()" nz-tooltip [nzTitle]="'tableButton.refresh' | translate"></i>
            <!--表下载  -->
            <i class="iconfont icon-xiazai" *ngIf="isShowTable && !tableError" nz-tooltip [nzTitle]="'tableButton.download' | translate"></i>
            <!-- 图下载 -->
            <app-chart-export *ngIf="!isShowTable && !chartError" [chartId]="chartId" [chartName]="chartName"></app-chart-export>
        </div>
    </div>
</ng-template>

<!-- <ng-template #selectPanel>
    <div #selectedPanel class="selectPanel">
        <div class="selectContent">
            <div *ngFor="let selected of selectPanelList">
                <span>{{selected.type}}</span>&nbsp;
                <button nz-button nzType="default" [nzSize]="'small'" *ngFor="let item of selected.data" [class.btnActive]="item.isChecked" (click)="selectClick(item)">{{item.name}}</button>
            </div>
        </div>
        <div class="right">
            <button nz-button nzType="primary" [nzSize]="'small'" (click)="selectConfirm()" [disabled]="!selectedList.length">确定</button>
        </div>
    </div>
</ng-template> -->

<div class="tableSwitchChart" [class.table-switch-chart-flex]="flex" [class.full-height]="flex" [attr.id]="id">
    <nz-spin [nzSpinning]="isLoading" nzTip='Loading...' [class.extend-height]="flex">
        <div class="flex column" [class.extend-height]="flex">
            <ng-container *ngTemplateOutlet="headerTemplate ? headerTemplate :''"></ng-container>

            <div #tableContent class="table-content" style="flex:1;display: flex;flex-direction: column;padding: 0 1px;">
                <!-- 选择面板 -->
                <!-- <ng-container *ngTemplateOutlet="(selectPanel && isHasSelectPanel) ? selectPanel :''"></ng-container> -->
                <div #selectPanel class="selectPanel" *ngIf="isShowSelectPanel && isHasSelectPanel && selectPanelList.length">
                    <div class="selectContent">
                        <div *ngFor="let selected of selectPanelList">
                            <span>{{selected.type}}</span>&nbsp;
                            <button nz-button nzType="default" [nzSize]="'small'" *ngFor="let item of selected.data" [class.btnActive]="item.isChecked" (click)="selectClick(item)">{{item.name}}</button>
                        </div>
                    </div>
                    <div class="right">
                        <button nz-button nzType="primary" [nzSize]="'small'" (click)="selectConfirm()" [disabled]="!selectedList.length">{{'tableButton.confirm' | translate}}</button>
                    </div>
                </div>
                <!-- 图和表的容器 -->
                <div #tableChartContent class="table-chart-content" [class.center-flex]="!isShowTable && !chartError" style="flex:1;border-bottom: 1px solid rgba(234, 234, 235, 0.95);" [ngStyle]="{'overflow':!isShowTable?'auto':'hidden'}">

                    <!-- 普通表  -->
                    <nz-table  *ngIf="!isVennTable && isShowTable && !tableError" nzShowPagination="false" [nzData]="tableData.rows" [nzScroll]="scroll" [nzSize]="'small'">
                        <thead>
                            <tr>
                                <th class="center textEllipsis" style="min-width:160px;max-width: 160px;" *ngFor="let thead of tableData['baseThead']" nz-tooltip [nzTitle]="thead.hover">{{thead.name}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let row of tableData.rows">
                                <td class="center textEllipsis" style="min-width:160px;max-width: 160px;" *ngFor="let thead of tableData['baseThead']"
                                nz-popover [nzContent]="row[thead.true_key]">{{row[thead.true_key] | accuracyPipe : accuracy : thead['searchType']}}</td>
                            </tr>
                        </tbody>
                    </nz-table>

                     <!-- 大表分页  -->
                     <div #tableBottom class="table-bottom" *ngIf="isBigTable && !isVennTable && isShowTable && !tableError">
                        <app-pagination style="float:left;" [(pageIndex)]="apiEntity['pageIndex']" [total]="total"
                            [(pageSize)]="apiEntity['pageSize']" (pageIndexChange)="getTableData()" (pageSizeChange)="pageSizeChange()">
                        </app-pagination>
                    </div>

                    <!-- veen/upsetR表 -->
                    <nz-table *ngIf="isVennTable && isShowTable && !tableError" nzShowPagination="false" [nzData]="tableData.rows" [nzScroll]="{y:scroll.y}" [nzSize]="'small'">
                        <thead>
                            <tr>
                                <th class="center" nzWidth="120px">name</th>
                                <th class="center" nzWidth="120px">value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let row of tableData['rows']">
                                <td class="center">{{row['name']}}</td>
                                <td class="center">{{row['value'] | accuracyPipe : accuracy : "double"}}</td>
                            </tr>
                        </tbody>
                    </nz-table>

                    <!-- chart -->
                    <div class="center chart" style="margin: 0 auto;" [hidden]="isShowTable || chartError">
                        <div [attr.id]="chartId"></div>
                    </div>

                    <!-- error -->
                    <app-error *ngIf="!isShowTable && chartError" [error]="chartError"></app-error>

                    <app-error *ngIf="isShowTable && tableError" [error]="tableError"></app-error>
                </div>
            </div>
        </div>
    </nz-spin>
</div>
