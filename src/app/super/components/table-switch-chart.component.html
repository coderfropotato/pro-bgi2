<ng-template #headerTemplate>
    <div class="table-thead tableHeader">
        <div class="fLeft">
            <!-- 图表切换按钮 -->
            <button nz-button [class.btnActive]="!isShowTable" [nzSize]="'small'" nzType="default" (click)="isShowTable=false" nz-tooltip nzTitle="统计视图">
                <i class="anticon anticon-area-chart"></i>
            </button>
            <button *ngIf="!isOnlyChart" nz-button [class.btnActive]="isShowTable" [nzSize]="'small'" nzType="default" (click)="isShowTable=true" nz-tooltip nzTitle="表格视图">
                <i class="anticon anticon-table"></i>
            </button>
            <!-- 下拉框 -->
            <ng-container *ngTemplateOutlet="selectTemplate ? selectTemplate :''"></ng-container>

        </div>
        <div class="fRight">
            <!-- 单选、多选 -->
            <nz-switch *ngIf="!isShowTable && isHasMultiSelect" class="switchBtn" [(ngModel)]="isMultiSelect" (ngModelChange)="getSelectModule()" nzCheckedChildren="多选" nzUnCheckedChildren="单选"></nz-switch>
            <button *ngIf="!isShowTable && isHasMultiSelect" class="multiConfirmBtn" nz-button nzType="primary" [nzSize]="'small'" [disabled]="!isMultiSelect" (click)="multipleConfirm()">确定</button>
            <!-- 精度下拉框 -->
            <nz-select style="width: 180px;margin-right: 10px" [(ngModel)]="accuracy" [nzSize]="'small'" *ngIf="isShowTable && isShowAccuracy">
                <nz-option *ngFor="let accu of accuracyList" [nzLabel]="accu.name" [nzValue]="accu.value"></nz-option>
            </nz-select>
            <!-- 设置 -->
            <ng-container *ngTemplateOutlet="setTemplate ? setTemplate :''"></ng-container>
            <!-- 刷新-->
            <i *ngIf="!chartUrl" class="anticon anticon-sync" (click)="getTableData()" nz-tooltip nzTitle="刷新"></i>
            <i *ngIf="chartUrl && isShowTable" class="anticon anticon-sync" (click)="getTableData()" nz-tooltip nzTitle="刷新"></i>
            <i *ngIf="chartUrl && !isShowTable" class="anticon anticon-sync" (click)="getChartData()" nz-tooltip nzTitle="刷新"></i>
            <!--表下载  -->
            <i class="anticon anticon-download" *ngIf="isShowTable && !error" nz-tooltip nzTitle="导出数据"></i>
            <!-- 图下载 -->
            <app-chart-export *ngIf="!isShowTable && !error" [chartId]="chartId" [chartName]="chartName"></app-chart-export>
        </div>
    </div>
</ng-template>

<!-- <ng-template #selectPanel>
    <div #selectedPanel class="selectPanel">
        <div class="selectContent">
            <div *ngFor="let selected of selectPanelList">
                <span>{{selected.type}}</span>&nbsp;
                <button nz-button nzType="default" [nzSize]="'small'" *ngFor="let item of selected.data" [class.btnActive]="item.isChecked" (click)="selectClick(item)">{{item.name}}</button>
            </div>
        </div>
        <div class="right">
            <button nz-button nzType="primary" [nzSize]="'small'" (click)="selectConfirm()" [disabled]="!selectedList.length">确定</button>
        </div>
    </div>
</ng-template> -->

<div class="tableSwitchChart" [class.table-switch-chart-flex]="flex" [class.full-height]="flex" [attr.id]="id">
    <nz-spin [nzSpinning]="isLoading" nzTip='Loading...' [class.extend-height]="flex">
        <div class="flex column" [class.extend-height]="flex">
            <ng-container *ngTemplateOutlet="headerTemplate ? headerTemplate :''"></ng-container>

            <div #tableContent class="table-content" style="flex:1;display: flex;flex-direction: column;padding: 0 1px;">
                <!-- <ng-container *ngTemplateOutlet="(selectPanel && isHasSelectPanel) ? selectPanel :''"></ng-container> -->
                <div #selectPanel class="selectPanel" *ngIf="isHasSelectPanel && selectPanelList.length">
                    <div class="selectContent">
                        <div *ngFor="let selected of selectPanelList">
                            <span>{{selected.type}}</span>&nbsp;
                            <button nz-button nzType="default" [nzSize]="'small'" *ngFor="let item of selected.data" [class.btnActive]="item.isChecked" (click)="selectClick(item)">{{item.name}}</button>
                        </div>
                    </div>
                    <div class="right">
                        <button nz-button nzType="primary" [nzSize]="'small'" (click)="selectConfirm()" [disabled]="!selectedList.length">确定</button>
                    </div>
                </div>
                <!-- 图和表的容器 -->
                <div #tableChartContent class="table-chart-content" [class.center-flex]="!isShowTable && !error" style="flex:1;border-bottom: 1px solid rgba(234, 234, 235, 0.95);" [ngStyle]="{'overflow':!isShowTable?'auto':'hidden'}">
                    <!-- table：固定表头-->
                    <nz-table nzShowPagination="false" [nzData]="isVennTable?chartData.rows:tableData.rows" [nzScroll]="scroll" [nzSize]="'small'" *ngIf="isShowTable && !error">
                        
                        <!-- 普通表 -->
                        <thead  *ngIf="!isVennTable">
                            <tr>
                                <th class="center" nzWidth="120px" *ngFor="let thead of tableData['baseThead']" nz-tooltip [nzTitle]="thead.hover">{{thead.name}}</th>
                            </tr>
                        </thead>
                        <tbody  *ngIf="!isVennTable">
                            <tr *ngFor="let row of tableData.rows">
                                <td class="center" *ngFor="let thead of tableData['baseThead']">{{row[thead.true_key] | accuracyPipe : accuracy : thead['searchType']}}</td>
                            </tr>
                        </tbody>

                        <!-- veen/upsetR表 -->
                        <thead  *ngIf="isVennTable">
                            <tr>
                                <th class="center" nzWidth="120px" nz-tooltip>name</th>
                                <th class="center" nzWidth="120px" nz-tooltip>value</th>
                            </tr>
                        </thead>
                        <tbody  *ngIf="isVennTable">
                            <tr *ngFor="let row of chartData['rows']">
                                <td class="center">{{row['name']}}</td>
                                <td class="center">{{row['value']}}</td>
                            </tr>
                        </tbody>

                    </nz-table>

                    <!-- chart -->
                    <div class="center chart" style="margin: 0 auto;"  [attr.id]="chartId" [hidden]="isShowTable || error"></div>

                    <!-- error -->
                    <app-error [error]="error"></app-error>
                </div>
            </div>
        </div>
    </nz-spin>
</div>
