
<div class="report-analysis net">
    <app-menu [menu]="[]" [geneSwitch]="false">
        <p class="menu-slot-text">重分析id：{{tid}}</p>
    </app-menu>

    <!-- delete link -->
    <nz-modal [(nzVisible)]="isShowDeleteModal" nzTitle="delete link" (nzOnCancel)="deleteCancel()" (nzOnOk)="deleteOk()">
        <p>删除结果将会保存，且不可撤销。是否确认删除？</p>
    </nz-modal>

    <!-- add link -->
    <nz-modal [(nzVisible)]="isShowAddModal" nzTitle="add link" (nzOnCancel)="addCancel()" (nzOnOk)="addOk()">
            <nz-row style="margin-bottom: 10px;">
                <nz-col nzSpan="4" style="margin-top: 5px;">
                    <span>Start</span>
                </nz-col>
                <nz-col nzSpan="13">
                    <nz-select style="width: 200px;margin-left: 10px" [(ngModel)]="curStartNode" nzShowSearch>
                        <nz-option *ngFor="let node of allNodes" [nzDisabled]="node.geneID===curEndNode" [nzLabel]="node.geneID" [nzValue]="node.geneID"></nz-option>
                    </nz-select>
                </nz-col>
            </nz-row>

            <nz-row style="margin-bottom: 10px;">
                <nz-col nzSpan="4" style="margin-top: 5px;">
                    <span>End</span>
                </nz-col>
                <nz-col nzSpan="13">
                    <nz-select style="width: 200px;margin-left: 10px" [(ngModel)]="curEndNode" nzShowSearch>
                        <nz-option *ngFor="let node of allNodes" [nzDisabled]="node.geneID===curStartNode" [nzLabel]="node.geneID" [nzValue]="node.geneID"></nz-option>
                    </nz-select>
                </nz-col>
            </nz-row>

            <nz-row style="margin-bottom: 10px;">
                <nz-col nzSpan="4" style="margin-top: 5px;">
                    <span>Score</span>
                </nz-col>
                <nz-col nzSpan="13">
                    <nz-slider [nzMin]="scoreMin" [nzMax]="scoreMax" [(ngModel)]="curScore"></nz-slider>
                </nz-col>
                <nz-col nzSpan="4" nzOffset="1">
                    <nz-input-number  [nzMin]="scoreMin" [nzMax]="scoreMax" [(ngModel)]="curScore"></nz-input-number>
                </nz-col>
            </nz-row>
    </nz-modal>

    <div class="content reanalysis-content row">
        <div #left class="left-layout column" [class.expand]="switch==='right'" [class.unexpand]="switch==='center'" [class.table-only]="switch==='left'">
            <!-- <div class="left-top-layout">
                <h4>title</h4>
                <p>describe</p>
            </div> -->
            <div class="left-bottom-layout">
                    <ng-template #setTemplate>
                        <app-netSet *ngIf="!isShowTable && setData && defaultSetData" [defaultSetData]='defaultSetData' (confirm)="setConfirm($event)" [setData]="setData"></app-netSet>
                    </ng-template>

                    <ng-template #funcBtnsTemplate>
                        <button nz-button nzType="primary" nzSize='small' style="margin-right: 10px" (click)='isShowAddModal=true'>add link</button>
                        <button nz-button nzType="primary" nzSize='small' style="margin-right: 10px" [disabled]="!selectLinkList.length" (click)="isShowDeleteModal=true">delete link</button>
                        <button nz-button nzType="primary" nzSize='small' style="margin-right: 10px" [disabled]="!selectGeneList.length" (click)="expandNode()">expand</button>
                    </ng-template>

                    <ng-template #searchTemplate>
                        <nz-select style="width: 180px;margin-left: 10px" nzPlaceHolder="Input gene ID" [(ngModel)]="curSearchNode" [nzSize]="'small'" (ngModelChange)="searchNodeChange()" nzShowSearch>
                            <nz-option *ngFor="let node of allNodes" [nzLabel]="node.geneID" [nzValue]="node.geneID"></nz-option>
                        </nz-select>
                    </ng-template>
                    
                    <!-- [selectTemplate]="selectTemplate" -->
                    <app-table-switch-chart
                        #relationNetChart
                        [isBigTable]='true'
                        [id]="'relationNetChart'"
                        [apiEntity]="chartEntity"
                        [chartUrl]="chartUrl"
                        [tableUrl]='tableUrl'
                        [setTemplate]="setTemplate"
                        (showTableChange)="showTableChange($event)"
                        [funcBtnsTemplate]='funcBtnsTemplate'
                        [searchTemplate]='searchTemplate'
                        (drawChartEmit)="drawChart($event)"
                        [chartId]="'relationNetChartDiv'"
                        [chartName]="'关联网络图'"
                        [setDataUrl]="setDataUrl"
                        [setDataEntity]="setDataEntity"
                        (setData)="getSetData($event)"
                        [flex]="true"
                        (refresh)="handlerRefresh()"
                    >
                    </app-table-switch-chart>

                    <app-color-picker [(color)]="color" (colorChange)="colorChange($event)" [(show)]="isShowColorPanel" ></app-color-picker>
            </div>
        </div>
        <div #right class="right-layout" [class.expand]="switch==='center'" [class.unexpand]="switch==='right'" [class.table-only]="switch==='left'">
            <div class="switch">
                <app-layout-switch [ngModel]="switch" (ngModelChange)="switchChange($event)"></app-layout-switch>
                </div>
            <div class="func" #func (click)="resize($event)">
                <!-- 增删列 -->
                <app-add-column #addColumn  (computedTableEvent)="computedTableHeight()" (toggle)="toggle($event)"  [baseThead]="baseThead" (addThead)="addThead($event)" [geneType]="geneType"></app-add-column>
                <!-- 关系 -->
                <app-gene-relative class="ml-12" *ngIf="!addColumnShow" #relative (confirmEvent)="confirm($event)"></app-gene-relative>
                <!-- 返回 -->
                <button class="ml12" [hidden]="addColumnShow || !showBackButton"  nz-button nzType="Default" (click)="back()">返回</button>
            </div>
            <!-- 表格转换 -->
            <ng-container>
                <app-table-transformation
                    class="no-outside-border"
                    #transformTable
                    [isFirst]="first"
                    [tableHeight]="tableHeight"
                    [defaultTableEntity]="defaultEntity"
                    [defaultTableUrl]="defaultUrl"
                    [defaultTableId]="defaultTableId"
                    [defaultTableDefaultChecked]="defaultDefaultChecked"
                    [(defaultEmitBaseThead)]="defaultEmitBaseThead"
                    (defaultBaseTheadChange)="baseTheadChange($event)"
                    [defaultTableCheckStatusInParams]="defaultCheckStatusInParams"
                    [extendTableEntity]="extendEntity"
                    [extendTableUrl]="extendUrl"
                    [extendTableId]="extendTableId"
                    [extendTableDefaultChecked]="extendDefaultChecked"
                    [(extendEmitBaseThead)]="extendEmitBaseThead"
                    (extendBaseTheadChange)="baseTheadChange($event)"
                    [extendTableCheckStatusInParams]="extendCheckStatusInParams"
                    [(applyOnceSearchParams)]="applyOnceSearchParams"
                ></app-table-transformation>
            </ng-container>
        </div>
    </div>
</div>
